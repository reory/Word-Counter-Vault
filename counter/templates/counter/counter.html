{% load static %}
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Word Counter</title>

    <!-- Bootstrap CSS -->
    <link 
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" 
      rel="stylesheet"
    >

    <!-- Your Dark Mode CSS -->
    <link rel="stylesheet" href="{% static 'counter/css/darkmode_utilities.css' %}">

    <!-- Custom Light Background -->
    <style>
        body {
            background: linear-gradient(
                to bottom right,
                #e8f1f8,
                #f9f9f9
            );
            min-height: 100vh;
        }

        .container {
            max-width: 800px;
        }
    </style>
</head>

<body class="bg-light">

<div class="container py-4">

    <!-- FLASH MESSAGES -->
    {% if messages %}
      {% for message in messages %}
        <div class="alert alert-success alert-dismissible fade show mt-3" role="alert">
          {{ message }}
          <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
      {% endfor %}
    {% endif %}

    <!-- ANALYSIS RESULT BOX -->
    {% if has_result %}
    <div class="card mb-3 border-success">
        <div class="card-header bg-success text-white">
            <h4 class="mb-0">Analysis Result</h4>
        </div>
        <div class="card-body">
            <p class="fs-5">
                {{ word_count }} Word{{ word_count|pluralize }} in the text
            </p>
            <hr>

            <!-- Collapse Toggle Button -->
            <button class="btn btn-outline-primary mb-3" 
                    data-bs-toggle="collapse" 
                    data-bs-target="#chartBox">
                Show / Hide Word Frequency Chart
            </button>

            <!-- Collapsible Chart Section -->
            <div id="chartBox" class="collapse">
                <h5>Word Frequency Chart</h5>
                <img 
                  src="{% url 'counter:chart' %}?text={{ text|urlencode }}" 
                  alt="Word frequency chart" 
                  class="img-fluid mt-2 mb-3"
                />
            </div>
        </div>
    </div>
    {% endif %}

    <!-- SUMMARY CARD -->
    {% if summary %}
    <div class="card mt-4 border-info">
        <div class="card-header bg-info text-white d-flex justify-content-between align-items-center">
            <h5 class="mb-0">Summary</h5>

            <button class="btn btn-light btn-sm"
                    data-bs-toggle="collapse"
                    data-bs-target="#summaryBox">
                Show / Hide
            </button>
        </div>

        <div id="summaryBox" class="collapse">
            <div class="card-body">

                <p><strong>Short Summary:</strong></p>
                <p>{{ summary }}</p>

                <hr>

                <p><strong>Key Points:</strong></p>
                <ul>
                    {% for b in bullets %}
                        <li>{{ b }}</li>
                    {% endfor %}
                </ul>

                <hr>

                <p><strong>Key Topics:</strong></p>
                <p>{{ topics|join:", " }}</p>

            </div>
        </div>
    </div>
    {% endif %}

    <!-- WRITING QUALITY CARD -->
    {% if longest_sentence %}
    <div class="card mt-4 border-warning">

        <div class="card-header bg-warning text-dark d-flex justify-content-between align-items-center">
            <h5 class="mb-0">Writing Quality Insights</h5>

            <button class="btn btn-dark btn-sm"
                    data-bs-toggle="collapse"
                    data-bs-target="#qualityBox">
                Show / Hide
            </button>
        </div>

        <div id="qualityBox" class="collapse">
            <div class="card-body">

                <p><strong>Longest Sentence:</strong></p>
                <p>{{ longest_sentence }}</p>

                <hr>

                <p><strong>Vocabulary Richness (TTR):</strong> {{ ttr }}</p>

                <hr>

                <p><strong>Overused Words:</strong></p>
                <ul>
                    {% for word, count in overused %}
                        <li>{{ word }} â€” {{ count }} times</li>
                    {% endfor %}
                </ul>

                <hr>

                <p><strong>Passive Voice Instances:</strong> {{ passive_count }}</p>

            </div>
        </div>
    </div>
    {% endif %}

    <!-- MAIN FORM -->
    <div class="card border-primary mt-4">
        <div class="card-body">

            <!-- Dark Mode Toggle -->
            <button id="themeToggle" class="btn btn-secondary mb-3">
                Toggle Dark Mode
            </button>

            <form action="{% url 'counter:home' %}" 
                  method="POST" 
                  enctype="multipart/form-data">

                {% csrf_token %}

                <!-- TEXTAREA INPUT -->
                <div class="mb-3">
                    <label for="text1" class="form-label">Paste your text here</label>
                    <textarea 
                        name="texttocount" 
                        id="text1" 
                        rows="8" 
                        class="form-control"
                        style="background-color: #f0f5f5;"
                        placeholder="Enter text to count words"
                    >{{ text }}</textarea>
                </div>

                <!-- FILE UPLOAD INPUT -->
                <div class="mb-3">
                    <label for="file" class="form-label">Upload a file (TXT or PDF, or DOCX)</label>
                    <input type="file" name="file" class="form-control">
                </div>

                <!-- SUBMIT BUTTON -->
                <div class="text-center">
                    <button type="submit" class="btn btn-primary w-25">
                        Run Counter
                    </button>
                    
                    {% if has_result %}

                       <!--           PDF EXPORT            -->
                       <a href="{% url 'counter:export_pdf' %}" 
                          class="btn btn-outline-secondary mt-3"> 
                           Download PDF Report 
                       </a>

                        <!--            DOCX EXPORT         -->
                       <a href="{% url 'counter:export_docx' %}" 
                          class="btn btn-outline-secondary mt-3"> 
                           Download DOCX Report 
                       </a>
                       
                    {% endif %}
                </div>

            </form>

        </div>
    </div>

</div>

<!-- Bootstrap JS -->
<script 
  src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js">
</script>

<!-- Dark Mode Toggle Script -->
<script>
    const toggleBtn = document.getElementById("themeToggle");
    const body = document.body;

    // Load saved theme
    if (localStorage.getItem("darkMode") === "true") {
        body.classList.add("dark-mode");
    }

    toggleBtn.addEventListener("click", () => {
        body.classList.toggle("dark-mode");

        // Save preference
        const isDark = body.classList.contains("dark-mode");
        localStorage.setItem("darkMode", isDark);
    });
</script>

</body>
</html>
